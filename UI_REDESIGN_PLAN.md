# ä¸‹è¼‰é é¢ UI é‡è¨­è¨ˆæ–¹æ¡ˆ

## å•é¡Œåˆ†æ

### ç¾æœ‰å•é¡Œ

1. **åŠŸèƒ½åˆ†æ•£**ï¼šã€Œç·šä¸Šé–±è®€ã€ã€ã€Œæ”¶è—ã€ã€ã€Œä¸‹è¼‰ã€æŒ‰éˆ•æ•£å¸ƒåœ¨ä¸åŒå€åŸŸ
2. **è¦–è¦ºæ··äº‚**ï¼šç¼ºä¹çµ±ä¸€çš„è¦–è¦ºç„¦é»
3. **ä¸æ˜ç¢ºçš„ç™»å…¥éœ€æ±‚**ï¼šç”¨æˆ¶é›£ä»¥å¿«é€Ÿç†è§£å“ªäº›åŠŸèƒ½éœ€è¦ç™»å…¥
4. **é‡è¤‡å…ƒç´ **ï¼šå¤šå€‹ä¸‹è¼‰æŒ‰éˆ•é€ æˆå›°æƒ‘

## è¨­è¨ˆç›®æ¨™

- âœ¨ å°‡æ‰€æœ‰éœ€ç™»å…¥åŠŸèƒ½æ•´åˆåˆ°ä¸€å€‹æ¸…æ™°çš„å€åŸŸ
- ğŸ¯ å»ºç«‹æ˜ç¢ºçš„è¦–è¦ºå±¤ç´š
- ğŸ” æ¸…æ¥šæ¨™ç¤ºç™»å…¥æ‰èƒ½ä½¿ç”¨çš„åŠŸèƒ½
- ğŸš€ å„ªåŒ–ç”¨æˆ¶è½‰æ›æµç¨‹

## è¨­è¨ˆæ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šçµ±ä¸€åŠŸèƒ½å¡ç‰‡ï¼ˆæ¨è–¦ï¼‰

å°‡ä¸‰å€‹æ ¸å¿ƒåŠŸèƒ½æ•´åˆåˆ°ä¸€å€‹å¡ç‰‡ä¸­ï¼Œæ¸…æ¥šå€åˆ†æœƒå“¡èˆ‡è¨ªå®¢åŠŸèƒ½ã€‚

#### è¦–è¦ºçµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ¯ å®Œæ•´åŠŸèƒ½é«”é©—              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ“–  â”‚  â”‚  â¤ï¸  â”‚  â”‚  â¬‡ï¸  â”‚      â”‚
â”‚  â”‚ç·šä¸Š  â”‚  â”‚ æ”¶è— â”‚  â”‚å¿«é€Ÿ  â”‚      â”‚
â”‚  â”‚é–±è®€  â”‚  â”‚      â”‚  â”‚ä¸‹è¼‰  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â”‚  [ğŸ” ç™»å…¥è§£é–å…¨éƒ¨åŠŸèƒ½]              â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ æˆ– â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                     â”‚
â”‚  â–¼ è¨ªå®¢ä¸‹è¼‰ï¼ˆéœ€å¡«è¡¨ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### HTML çµæ§‹

```html
<div class="action-card">
  <!-- æœƒå“¡åŠŸèƒ½å€ -->
  <div class="member-features">
    <h3>ğŸ¯ å®Œæ•´åŠŸèƒ½é«”é©—</h3>
    <div class="features-grid">
      <button class="feature-item" data-requires-login="true">
        <span class="icon">ğŸ“–</span>
        <span class="label">ç·šä¸Šé–±è®€</span>
        <span class="badge">æœƒå“¡å°ˆå±¬</span>
      </button>

      <button class="feature-item" data-requires-login="true">
        <span class="icon">â¤ï¸</span>
        <span class="label">æ”¶è—</span>
        <span class="badge">æœƒå“¡å°ˆå±¬</span>
      </button>

      <button class="feature-item" data-requires-login="true">
        <span class="icon">â¬‡ï¸</span>
        <span class="label">å¿«é€Ÿä¸‹è¼‰</span>
        <span class="badge">å…å¡«è¡¨</span>
      </button>
    </div>

    <button class="btn-primary">ğŸ” ç™»å…¥è§£é–å…¨éƒ¨åŠŸèƒ½</button>
  </div>

  <!-- è¨ªå®¢é¸é … -->
  <div class="guest-option">
    <div class="divider">æˆ–</div>
    <details class="guest-form">
      <summary>è¨ªå®¢ä¸‹è¼‰ï¼ˆéœ€å¡«è¡¨ï¼‰</summary>
      <!-- è¡¨å–®å…§å®¹ -->
    </details>
  </div>
</div>
```

### æ–¹æ¡ˆäºŒï¼šæ¼¸é€²å¼åŠŸèƒ½è§£é–

ä½¿ç”¨è¦–è¦ºåŒ–çš„é€²åº¦æ¢å±•ç¤ºå·²è§£é–çš„åŠŸèƒ½ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŠŸèƒ½è§£é–é€²åº¦ [â– â–¡â–¡] 1/3             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… æª”æ¡ˆä¸‹è¼‰ï¼ˆå·²è§£é–ï¼‰              â”‚
â”‚  ğŸ”’ ç·šä¸Šé–±è®€ï¼ˆéœ€ç™»å…¥ï¼‰              â”‚
â”‚  ğŸ”’ æ”¶è—åŠŸèƒ½ï¼ˆéœ€ç™»å…¥ï¼‰              â”‚
â”‚                                     â”‚
â”‚  [ç™»å…¥è§£é–æ›´å¤šåŠŸèƒ½ â†’]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–¹æ¡ˆä¸‰ï¼šæ™ºæ…§åˆ‡æ›å¡ç‰‡

æ ¹æ“šç”¨æˆ¶ç‹€æ…‹é¡¯ç¤ºä¸åŒçš„ç•Œé¢ã€‚

```html
<!-- æœªç™»å…¥ï¼šé¡¯ç¤ºåŠŸèƒ½é è¦½ -->
<div class="smart-card not-logged-in">
  <div class="preview-mode">
    <h3>ç™»å…¥äº«å—å®Œæ•´åŠŸèƒ½</h3>
    <ul class="feature-list">
      <li>ğŸ“– ç·šä¸Šç›´æ¥é–±è®€</li>
      <li>â¤ï¸ ä¸€éµæ”¶è—</li>
      <li>â¬‡ï¸ å…å¡«è¡¨å¿«é€Ÿä¸‹è¼‰</li>
    </ul>
    <button class="btn-login">ç«‹å³ç™»å…¥</button>
  </div>
  <details class="guest-download">
    <summary>ç¹¼çºŒä»¥è¨ªå®¢èº«ä»½ä¸‹è¼‰</summary>
    <!-- è¨ªå®¢è¡¨å–® -->
  </details>
</div>

<!-- å·²ç™»å…¥ï¼šç›´æ¥é¡¯ç¤ºæ“ä½œæŒ‰éˆ• -->
<div class="smart-card logged-in">
  <div class="quick-actions">
    <button class="btn-read">ğŸ“– ç·šä¸Šé–±è®€</button>
    <button class="btn-favorite">â¤ï¸ æ”¶è—</button>
    <button class="btn-download">â¬‡ï¸ ä¸‹è¼‰</button>
  </div>
  <div class="user-info">å·²ç™»å…¥ç‚ºï¼šuser@example.com</div>
</div>
```

## è©³ç´°äº’å‹•è¨­è¨ˆ

### ç”¨æˆ¶æµç¨‹åœ–

```mermaid
graph TD
    A[é€²å…¥ä¸‹è¼‰é é¢] --> B{æª¢æŸ¥ç™»å…¥ç‹€æ…‹}
    B -->|å·²ç™»å…¥| C[é¡¯ç¤ºæœƒå“¡æ¨¡å¼]
    B -->|æœªç™»å…¥| D[é¡¯ç¤ºè¨ªå®¢æ¨¡å¼]

    C --> E[ä¸‰å€‹åŠŸèƒ½æŒ‰éˆ•å¯ç”¨]
    E --> F[ç·šä¸Šé–±è®€]
    E --> G[æ”¶è—]
    E --> H[å¿«é€Ÿä¸‹è¼‰]

    D --> I[é¡¯ç¤ºåŠŸèƒ½é è¦½]
    I --> J[ç™»å…¥ CTA]
    I --> K[è¨ªå®¢è¡¨å–®æŠ˜ç–Š]

    J --> L[å‰å¾€ç™»å…¥é ]
    K --> M[å±•é–‹è¡¨å–®]
    M --> N[å¡«å¯«è³‡æ–™]
    N --> O[ä¸‹è¼‰æª”æ¡ˆ]

    L --> P[ç™»å…¥æˆåŠŸ]
    P --> C
```

### äº’å‹•ç‹€æ…‹å®šç¾©

#### 1. åˆå§‹è¼‰å…¥ç‹€æ…‹

- **Loading**: é¡¯ç¤ºéª¨æ¶å±æˆ–è¼‰å…¥å‹•ç•«
- **Error**: é¡¯ç¤ºéŒ¯èª¤æç¤ºå’Œé‡è©¦æŒ‰éˆ•
- **Success**: æ ¹æ“šç”¨æˆ¶ç‹€æ…‹é¡¯ç¤ºç›¸æ‡‰ç•Œé¢

#### 2. æŒ‰éˆ•ç‹€æ…‹

```css
/* æ­£å¸¸ç‹€æ…‹ */
.btn-primary {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  transition: all 0.3s ease;
}

/* æ‡¸åœç‹€æ…‹ */
.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
}

/* é»æ“Šç‹€æ…‹ */
.btn-primary:active {
  transform: translateY(0);
  box-shadow: 0 2px 10px rgba(59, 130, 246, 0.4);
}

/* ç¦ç”¨ç‹€æ…‹ */
.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* è¼‰å…¥ç‹€æ…‹ */
.btn-primary.loading {
  position: relative;
  color: transparent;
}

.btn-primary.loading::after {
  content: "";
  position: absolute;
  width: 20px;
  height: 20px;
  border: 2px solid white;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 0.6s linear infinite;
}
```

### å‹•ç•«æ•ˆæœè¨­è¨ˆ

#### 1. é é¢åˆ‡æ›å‹•ç•«

```javascript
// å¹³æ»‘åˆ‡æ›è¦–åœ–
function switchView(fromView, toView) {
  const from = document.getElementById(fromView);
  const to = document.getElementById(toView);

  // æ·¡å‡ºèˆŠè¦–åœ–
  from.style.animation = "fadeOut 0.3s ease";

  setTimeout(() => {
    from.style.display = "none";
    to.style.display = "block";
    // æ·¡å…¥æ–°è¦–åœ–
    to.style.animation = "fadeIn 0.3s ease";
  }, 300);
}

// CSS å‹•ç•«å®šç¾©
const animations = `
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes fadeOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-10px); }
  }
  
  @keyframes slideIn {
    from { transform: translateX(-100%); }
    to { transform: translateX(0); }
  }
  
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
`;
```

#### 2. å¾®äº’å‹•è¨­è¨ˆ

```javascript
// åŠŸèƒ½å¡ç‰‡æ‡¸åœæ•ˆæœ
document.querySelectorAll(".feature-item").forEach((item) => {
  item.addEventListener("mouseenter", function () {
    this.style.transform = "translateY(-4px)";
    this.style.boxShadow = "0 8px 24px rgba(0,0,0,0.12)";
  });

  item.addEventListener("mouseleave", function () {
    this.style.transform = "translateY(0)";
    this.style.boxShadow = "0 4px 12px rgba(0,0,0,0.08)";
  });
});

// æŒ‰éˆ•é»æ“Šæ³¢ç´‹æ•ˆæœ
function createRipple(event) {
  const button = event.currentTarget;
  const ripple = document.createElement("span");
  const rect = button.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  const x = event.clientX - rect.left - size / 2;
  const y = event.clientY - rect.top - size / 2;

  ripple.style.width = ripple.style.height = size + "px";
  ripple.style.left = x + "px";
  ripple.style.top = y + "px";
  ripple.classList.add("ripple");

  button.appendChild(ripple);

  setTimeout(() => ripple.remove(), 600);
}
```

## å¯¦æ–½å»ºè­°

### å„ªå…ˆç´šæ’åº

1. **ç«‹å³æ”¹å–„**ï¼šæ•´åˆåŠŸèƒ½åˆ°çµ±ä¸€å€åŸŸï¼ˆæ–¹æ¡ˆä¸€ï¼‰
2. **çŸ­æœŸå„ªåŒ–**ï¼šæ”¹é€²è¦–è¦ºå±¤ç´šå’Œé¡è‰²å°æ¯”
3. **é•·æœŸè¨ˆåŠƒ**ï¼šæ ¹æ“šç”¨æˆ¶æ•¸æ“šå„ªåŒ–æµç¨‹

### è¦–è¦ºè¨­è¨ˆåŸå‰‡

- **å±¤ç´šæ¸…æ™°**ï¼šä¸»è¦ CTA > æ¬¡è¦åŠŸèƒ½ > è¼”åŠ©ä¿¡æ¯
- **é¡è‰²é‹ç”¨**ï¼š
  - ä¸»è¦å‹•ä½œï¼ˆç™»å…¥/ä¸‹è¼‰ï¼‰ï¼šç¶ è‰²æˆ–è—è‰²
  - æœƒå“¡å°ˆå±¬ï¼šé‡‘è‰²æˆ–ç´«è‰²æ¨™è¨˜
  - è¨ªå®¢é¸é …ï¼šç°è‰²èª¿
- **åœ–æ¨™ä¸€è‡´**ï¼šçµ±ä¸€ä½¿ç”¨ emoji æˆ– SVG
- **ç•™ç™½å……è¶³**ï¼šé¿å…æ“æ“ ï¼Œæå‡å¯è®€æ€§

### æ–‡æ¡ˆå„ªåŒ–

- å¼·èª¿æœƒå“¡åƒ¹å€¼ï¼šã€Œç™»å…¥è§£é– 3 å¤§å°ˆå±¬åŠŸèƒ½ã€
- é™ä½è¨ªå®¢é˜»åŠ›ï¼šã€Œæˆ–ä»¥è¨ªå®¢èº«ä»½ç¹¼çºŒã€
- æ˜ç¢ºæŒ‡å¼•ï¼šä½¿ç”¨å‹•è©é–‹é ­çš„æŒ‰éˆ•æ–‡å­—

## é æœŸæ•ˆæœ

1. **æå‡è½‰æ›ç‡**

   - æ¸…æ™°çš„åƒ¹å€¼ä¸»å¼µä¿ƒé€²è¨»å†Š
   - ç°¡åŒ–çš„æµç¨‹æ¸›å°‘è·³å‡º

2. **æ”¹å–„ç”¨æˆ¶é«”é©—**

   - ä¸€ç›®äº†ç„¶çš„åŠŸèƒ½å€åˆ†
   - æ¸›å°‘é‡è¤‡å’Œå›°æƒ‘

3. **å¢å¼·å“ç‰Œå½¢è±¡**
   - å°ˆæ¥­çš„ç•Œé¢è¨­è¨ˆ
   - çµ±ä¸€çš„è¦–è¦ºèªè¨€

## æŠ€è¡“å¯¦ä½œè¦é»

### çµ±ä¸€çš„ç‹€æ…‹ç®¡ç†ç³»çµ±

```javascript
// å¢å¼·ç‰ˆç‹€æ…‹ç®¡ç†å™¨
class EnhancedAuthStateManager {
  constructor() {
    this.isLoggedIn = false;
    this.user = null;
    this.features = {
      readOnline: { enabled: false, loading: false },
      favorite: { enabled: false, loading: false },
      download: { enabled: false, loading: false },
    };
    this.listeners = [];
  }

  // è¨‚é–±ç‹€æ…‹è®ŠåŒ–
  subscribe(callback) {
    this.listeners.push(callback);
    return () => {
      this.listeners = this.listeners.filter((l) => l !== callback);
    };
  }

  // é€šçŸ¥ç‹€æ…‹è®ŠåŒ–
  notify() {
    this.listeners.forEach((callback) => callback(this));
  }

  async checkAuth() {
    const token = localStorage.getItem("authToken");
    if (!token) {
      this.setGuestMode();
      return;
    }

    try {
      const response = await fetch("/api/auth/me", {
        headers: { Authorization: `Bearer ${token}` },
      });

      if (response.ok) {
        const data = await response.json();
        this.setMemberMode(data.user);
      } else {
        this.setGuestMode();
        localStorage.removeItem("authToken");
      }
    } catch (error) {
      console.error("Auth check failed:", error);
      this.setGuestMode();
    }
  }

  setMemberMode(user) {
    this.isLoggedIn = true;
    this.user = user;
    this.features = {
      readOnline: { enabled: true, loading: false },
      favorite: { enabled: true, loading: false },
      download: { enabled: true, loading: false },
    };
    this.notify();
    this.renderMemberView();
  }

  setGuestMode() {
    this.isLoggedIn = false;
    this.user = null;
    this.features = {
      readOnline: { enabled: false, loading: false },
      favorite: { enabled: false, loading: false },
      download: { enabled: true, loading: false }, // è¨ªå®¢å¯ä¸‹è¼‰ä½†éœ€å¡«è¡¨
    };
    this.notify();
    this.renderGuestView();
  }

  renderMemberView() {
    const container = document.querySelector(".action-card");
    container.innerHTML = `
      <div class="member-view" style="animation: fadeIn 0.3s ease;">
        <!-- ç”¨æˆ¶å•å€™ -->
        <div class="user-greeting">
          <div class="user-avatar">${this.user.name[0].toUpperCase()}</div>
          <div class="user-info">
            <h4>æ­¡è¿å›ä¾†ï¼Œ${this.user.name}ï¼</h4>
            <p>äº«å—å®Œæ•´åŠŸèƒ½é«”é©—</p>
          </div>
        </div>
        
        <!-- åŠŸèƒ½æŒ‰éˆ•ç¶²æ ¼ -->
        <div class="feature-grid">
          <button class="feature-btn read-online" onclick="handleReadOnline()">
            <span class="icon">ğŸ“–</span>
            <span class="label">ç·šä¸Šé–±è®€</span>
            <span class="status">å¯ç”¨</span>
          </button>
          
          <button class="feature-btn favorite" onclick="handleFavorite()">
            <span class="icon">â¤ï¸</span>
            <span class="label">æ”¶è—</span>
            <span class="status">å¯ç”¨</span>
          </button>
          
          <button class="feature-btn download" onclick="handleQuickDownload()">
            <span class="icon">â¬‡ï¸</span>
            <span class="label">å¿«é€Ÿä¸‹è¼‰</span>
            <span class="status">å…å¡«è¡¨</span>
          </button>
        </div>
        
        <!-- é¡å¤–åŠŸèƒ½ -->
        <div class="extra-features">
          <button class="btn-secondary" onclick="handleShare()">
            <svg><!-- share icon --></svg>
            åˆ†äº«é é¢
          </button>
          <button class="btn-text" onclick="viewHistory()">
            æŸ¥çœ‹ä¸‹è¼‰æ­·å²
          </button>
        </div>
      </div>
    `;
  }

  renderGuestView() {
    const container = document.querySelector(".action-card");
    container.innerHTML = `
      <div class="guest-view" style="animation: fadeIn 0.3s ease;">
        <!-- åŠŸèƒ½é è¦½å€ -->
        <div class="features-preview">
          <h3>ğŸ¯ å®Œæ•´åŠŸèƒ½ä¸€è¦½</h3>
          <div class="preview-grid">
            <div class="preview-item locked">
              <div class="icon">ğŸ“–</div>
              <div class="content">
                <h4>ç·šä¸Šé–±è®€</h4>
                <p>ç„¡éœ€ä¸‹è¼‰ï¼Œç›´æ¥ç€è¦½</p>
                <span class="badge">éœ€ç™»å…¥</span>
              </div>
            </div>
            
            <div class="preview-item locked">
              <div class="icon">â¤ï¸</div>
              <div class="content">
                <h4>æ”¶è—åŠŸèƒ½</h4>
                <p>å»ºç«‹å€‹äººè³‡æ–™åº«</p>
                <span class="badge">éœ€ç™»å…¥</span>
              </div>
            </div>
            
            <div class="preview-item available">
              <div class="icon">â¬‡ï¸</div>
              <div class="content">
                <h4>æª”æ¡ˆä¸‹è¼‰</h4>
                <p>æœƒå“¡å…å¡«è¡¨å–®</p>
                <span class="badge success">å¯ç”¨</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ç™»å…¥ CTA -->
        <div class="login-cta">
          <h4>ç™»å…¥è§£é–å…¨éƒ¨åŠŸèƒ½</h4>
          <ul class="benefits-list">
            <li>âœ… ç·šä¸Šç›´æ¥é–±è®€ï¼Œç„¡éœ€ä¸‹è¼‰æª”æ¡ˆ</li>
            <li>âœ… æ”¶è—å–œæ„›å…§å®¹ï¼Œéš¨æ™‚æŸ¥çœ‹</li>
            <li>âœ… ä¸€éµå¿«é€Ÿä¸‹è¼‰ï¼Œå…å¡«è¡¨å–®</li>
            <li>âœ… æŸ¥çœ‹å®Œæ•´ä¸‹è¼‰æ­·å²</li>
          </ul>
          <button class="btn-primary large" onclick="goToLogin()">
            <span class="icon">ğŸ‘¤</span>
            ç«‹å³ç™»å…¥
          </button>
        </div>
        
        <!-- è¨ªå®¢ä¸‹è¼‰é¸é … -->
        <div class="guest-download-section">
          <div class="divider">
            <span>æˆ–ç¹¼çºŒä»¥è¨ªå®¢èº«ä»½</span>
          </div>
          
          <details class="guest-form-wrapper">
            <summary class="toggle-form">
              è¨ªå®¢ä¸‹è¼‰ï¼ˆéœ€å¡«å¯«è³‡æ–™ï¼‰
              <span class="arrow">â–¼</span>
            </summary>
            
            <form class="guest-form" onsubmit="handleGuestDownload(event)">
              <div class="form-group">
                <label>å§“å <span class="required">*</span></label>
                <input type="text" name="name" required>
              </div>
              
              <div class="form-group">
                <label>é›»å­éƒµä»¶ <span class="required">*</span></label>
                <input type="email" name="email" required>
              </div>
              
              <div class="form-group">
                <label>
                  <input type="checkbox" name="subscribe">
                  æ¥æ”¶æ›´æ–°é€šçŸ¥
                </label>
              </div>
              
              <button type="submit" class="btn-secondary">
                æäº¤ä¸¦ä¸‹è¼‰
              </button>
            </form>
          </details>
        </div>
      </div>
    `;
  }
}

// åˆå§‹åŒ–ç®¡ç†å™¨
const authManager = new EnhancedAuthStateManager();
document.addEventListener("DOMContentLoaded", () => {
  authManager.checkAuth();
});
```

### åŠŸèƒ½è™•ç†å‡½æ•¸

```javascript
// ç·šä¸Šé–±è®€è™•ç†
async function handleReadOnline() {
  if (!authManager.isLoggedIn) {
    showLoginPrompt("éœ€è¦ç™»å…¥æ‰èƒ½ä½¿ç”¨ç·šä¸Šé–±è®€åŠŸèƒ½");
    return;
  }

  // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
  const btn = event.currentTarget;
  btn.classList.add("loading");

  try {
    // é–‹å•Ÿé è¦½çª—å£æˆ–å°å‘é è¦½é é¢
    window.open(`/preview/${pageSlug}`, "_blank");
  } catch (error) {
    showError("ç„¡æ³•é–‹å•Ÿé è¦½");
  } finally {
    btn.classList.remove("loading");
  }
}

// æ”¶è—è™•ç†
async function handleFavorite() {
  if (!authManager.isLoggedIn) {
    showLoginPrompt("éœ€è¦ç™»å…¥æ‰èƒ½ä½¿ç”¨æ”¶è—åŠŸèƒ½");
    return;
  }

  const btn = event.currentTarget;
  btn.classList.add("loading");

  try {
    const response = await fetch(`/api/favorite/${pageId}`, {
      method: "POST",
      headers: {
        Authorization: `Bearer ${localStorage.getItem("authToken")}`,
        "Content-Type": "application/json",
      },
    });

    if (response.ok) {
      btn.classList.add("favorited");
      showSuccess("å·²åŠ å…¥æ”¶è—");
    }
  } catch (error) {
    showError("æ”¶è—å¤±æ•—");
  } finally {
    btn.classList.remove("loading");
  }
}

// å¿«é€Ÿä¸‹è¼‰è™•ç†
async function handleQuickDownload() {
  if (!authManager.isLoggedIn) {
    // è¨ªå®¢éœ€è¦å¡«è¡¨
    document.querySelector(".guest-form-wrapper").open = true;
    document.querySelector(".guest-form-wrapper").scrollIntoView({
      behavior: "smooth",
    });
    return;
  }

  const btn = event.currentTarget;
  btn.classList.add("loading");

  try {
    const response = await fetch(`/download-page/${pageSlug}/quick`, {
      method: "POST",
      headers: {
        Authorization: `Bearer ${localStorage.getItem("authToken")}`,
      },
    });

    const data = await response.json();
    if (data.success) {
      // é–‹å§‹ä¸‹è¼‰
      const a = document.createElement("a");
      a.href = data.downloadUrl;
      a.download = "";
      a.click();

      showSuccess("ä¸‹è¼‰å·²é–‹å§‹");
    }
  } catch (error) {
    showError("ä¸‹è¼‰å¤±æ•—");
  } finally {
    btn.classList.remove("loading");
  }
}

// è¨ªå®¢ä¸‹è¼‰è™•ç†
async function handleGuestDownload(event) {
  event.preventDefault();

  const form = event.target;
  const submitBtn = form.querySelector('button[type="submit"]');
  submitBtn.classList.add("loading");

  const formData = new FormData(form);

  try {
    const response = await fetch(`/download-page/${pageSlug}/submit`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: formData.get("name"),
        email: formData.get("email"),
        subscribe: formData.get("subscribe") === "on",
      }),
    });

    const data = await response.json();
    if (data.success) {
      // é–‹å§‹ä¸‹è¼‰
      const a = document.createElement("a");
      a.href = data.downloadUrl;
      a.download = "";
      a.click();

      // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
      showSuccess("æ„Ÿè¬æ‚¨ï¼ä¸‹è¼‰å³å°‡é–‹å§‹");

      // æ¸…ç©ºè¡¨å–®
      form.reset();
    }
  } catch (error) {
    showError("æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
  } finally {
    submitBtn.classList.remove("loading");
  }
}

// è¼”åŠ©å‡½æ•¸ï¼šé¡¯ç¤ºæç¤º
function showLoginPrompt(message) {
  const modal = createModal({
    title: "éœ€è¦ç™»å…¥",
    content: `
      <div class="login-prompt-modal">
        <div class="icon">ğŸ”</div>
        <p>${message}</p>
        <div class="actions">
          <button onclick="closeModal()" class="btn-secondary">å–æ¶ˆ</button>
          <button onclick="goToLogin()" class="btn-primary">å‰å¾€ç™»å…¥</button>
        </div>
      </div>
    `,
  });
  document.body.appendChild(modal);
}

function showSuccess(message) {
  const toast = createToast(message, "success");
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

function showError(message) {
  const toast = createToast(message, "error");
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}
```

### éŸ¿æ‡‰å¼è¨­è¨ˆè€ƒé‡

```css
/* æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
@media (max-width: 768px) {
  .feature-grid {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .feature-btn {
    min-height: 60px;
    font-size: 16px;
  }

  .btn-primary.large {
    width: 100%;
    padding: 16px;
    font-size: 18px;
  }

  .preview-grid {
    grid-template-columns: 1fr;
  }

  .user-greeting {
    flex-direction: column;
    text-align: center;
  }
}

/* å¹³æ¿èª¿æ•´ */
@media (min-width: 769px) and (max-width: 1024px) {
  .feature-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .preview-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* æ¡Œé¢ç‰ˆå„ªåŒ– */
@media (min-width: 1025px) {
  .action-card {
    max-width: 800px;
    margin: 0 auto;
  }

  .feature-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }

  .preview-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}
```

### ç„¡éšœç¤™æ€§è¨­è¨ˆ

```javascript
// éµç›¤å°èˆªæ”¯æ´
document.querySelectorAll(".feature-btn").forEach((btn, index) => {
  btn.setAttribute("tabindex", index + 1);
  btn.setAttribute("role", "button");
  btn.setAttribute("aria-label", btn.querySelector(".label").textContent);

  // Enter å’Œç©ºæ ¼éµè§¸ç™¼
  btn.addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      btn.click();
    }
  });
});

// è¢å¹•é–±è®€å™¨æç¤º
function announceToScreenReader(message) {
  const announcement = document.createElement("div");
  announcement.setAttribute("role", "alert");
  announcement.setAttribute("aria-live", "polite");
  announcement.style.position = "absolute";
  announcement.style.left = "-10000px";
  announcement.textContent = message;

  document.body.appendChild(announcement);
  setTimeout(() => announcement.remove(), 1000);
}

// ARIA æ¨™ç±¤
document.querySelector(".action-card").setAttribute("role", "region");
document.querySelector(".action-card").setAttribute("aria-label", "é é¢æ“ä½œå€");
document
  .querySelector(".guest-form-wrapper")
  .setAttribute("aria-expanded", "false");

// åˆ‡æ›è¡¨å–®å±•é–‹ç‹€æ…‹
document
  .querySelector(".guest-form-wrapper")
  .addEventListener("toggle", (e) => {
    e.target.setAttribute("aria-expanded", e.target.open);
  });
```

## æ¸¬è©¦é‡é»

1. **A/B æ¸¬è©¦**

   - æ¸¬è©¦ä¸åŒæ–¹æ¡ˆçš„è½‰æ›ç‡
   - è¿½è¹¤ç”¨æˆ¶è¡Œç‚ºè·¯å¾‘

2. **éŸ¿æ‡‰å¼è¨­è¨ˆ**

   - æ‰‹æ©Ÿç‰ˆçš„æŒ‰éˆ•å¤§å°å’Œé–“è·
   - å¹³æ¿çš„å¸ƒå±€èª¿æ•´

3. **ç„¡éšœç¤™æ€§**
   - éµç›¤å°èˆªæ”¯æ´
   - è¢å¹•é–±è®€å™¨ç›¸å®¹æ€§

## æ•ˆèƒ½å„ªåŒ–å»ºè­°

### 1. å»¶é²è¼‰å…¥

```javascript
// å»¶é²è¼‰å…¥éé—œéµè³‡æº
const lazyLoadFeatures = () => {
  if ("IntersectionObserver" in window) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          // è¼‰å…¥åŠŸèƒ½æ¨¡çµ„
          import("./features.js").then((module) => {
            module.initFeatures();
          });
          observer.unobserve(entry.target);
        }
      });
    });

    observer.observe(document.querySelector(".action-card"));
  }
};
```

### 2. ç‹€æ…‹å¿«å–

```javascript
// å¿«å–èªè­‰ç‹€æ…‹
const cacheAuthState = {
  set(state) {
    sessionStorage.setItem(
      "authState",
      JSON.stringify({
        ...state,
        timestamp: Date.now(),
      })
    );
  },

  get() {
    const cached = sessionStorage.getItem("authState");
    if (!cached) return null;

    const state = JSON.parse(cached);
    // 5 åˆ†é˜å…§æœ‰æ•ˆ
    if (Date.now() - state.timestamp < 300000) {
      return state;
    }
    return null;
  },
};
```

### 3. é è¼‰å…¥é—œéµè³‡æº

```html
<!-- é è¼‰å…¥å­—é«” -->
<link rel="preload" href="/fonts/inter.woff2" as="font" crossorigin />

<!-- é é€£æ¥ API -->
<link rel="preconnect" href="https://api.example.com" />

<!-- é å–ä¸‹ä¸€æ­¥å¯èƒ½çš„é é¢ -->
<link rel="prefetch" href="/login" />
```

## çµè«–

é€éæ•´åˆåˆ†æ•£çš„åŠŸèƒ½ã€å»ºç«‹æ¸…æ™°çš„è¦–è¦ºå±¤ç´šï¼Œä»¥åŠå„ªåŒ–ç”¨æˆ¶æµç¨‹ï¼Œæ–°çš„ UI è¨­è¨ˆå°‡èƒ½ï¼š

- æå‡ç”¨æˆ¶é«”é©—
- å¢åŠ æœƒå“¡è½‰æ›
- æ¸›å°‘ä½¿ç”¨å›°æƒ‘

å»ºè­°å„ªå…ˆå¯¦æ–½æ–¹æ¡ˆä¸€ï¼ˆçµ±ä¸€åŠŸèƒ½å¡ç‰‡ï¼‰ï¼Œä¸¦æ ¹æ“šç”¨æˆ¶åé¥‹æŒçºŒå„ªåŒ–ã€‚
