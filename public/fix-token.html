<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¾©æª”æ¡ˆç€è¦½å™¨ Token</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .fix-button {
            background-color: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s;
        }
        .fix-button:hover {
            background-color: #45a049;
        }
        .test-button {
            background-color: #2196F3;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s;
        }
        .test-button:hover {
            background-color: #1976D2;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .steps {
            text-align: left;
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .steps h3 {
            color: #333;
            margin-top: 0;
        }
        .steps ol {
            padding-left: 20px;
        }
        .steps li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ä¿®å¾©æª”æ¡ˆç€è¦½å™¨</h1>
        
        <div class="description">
            å¦‚æœæ‚¨ç„¡æ³•åœ¨æª”æ¡ˆç®¡ç†ä¸­çœ‹åˆ°å…§å®¹ï¼Œé€™é€šå¸¸æ˜¯å› ç‚ºç€è¦½å™¨ç¼ºå°‘å¿…è¦çš„èªè­‰ä¿¡æ¯ã€‚<br>
            é»æ“Šä¸‹é¢çš„æŒ‰éˆ•ä¾†è‡ªå‹•ä¿®å¾©é€™å€‹å•é¡Œã€‚
        </div>

        <button class="fix-button" onclick="fixToken()">
            ğŸ”‘ è‡ªå‹•ä¿®å¾© Token
        </button>

        <button class="test-button" onclick="testFileViewer()">
            ğŸ§ª æ¸¬è©¦æª”æ¡ˆç€è¦½å™¨
        </button>

        <div id="status"></div>

        <div class="steps">
            <h3>ğŸ“‹ å®Œæ•´æ“ä½œæ­¥é©Ÿï¼š</h3>
            <ol>
                <li><strong>ç¬¬ä¸€æ­¥</strong>ï¼šé»æ“Šä¸Šæ–¹çš„ã€Œè‡ªå‹•ä¿®å¾© Tokenã€æŒ‰éˆ•</li>
                <li><strong>ç¬¬äºŒæ­¥</strong>ï¼šç­‰å¾…çœ‹åˆ°ã€Œä¿®å¾©æˆåŠŸã€è¨Šæ¯</li>
                <li><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šé»æ“Šã€Œæ¸¬è©¦æª”æ¡ˆç€è¦½å™¨ã€æˆ–ç›´æ¥å‰å¾€ <a href="/file-viewer.html" target="_blank">æª”æ¡ˆç€è¦½å™¨é é¢</a></li>
                <li><strong>ç¬¬å››æ­¥</strong>ï¼šå¦‚æœä»ç„¶æœ‰å•é¡Œï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦</li>
            </ol>
        </div>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = 'status ' + type;
        }

        function fixToken() {
            try {
                // ç”Ÿæˆä¸€å€‹è‡¨æ™‚çš„JWT token (å¯¦éš›æ‡‰è©²å¾å¾Œç«¯ç²å–)
                const payload = {
                    userId: 1,
                    username: 'temp_user',
                    iat: Math.floor(Date.now() / 1000),
                    exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24å°æ™‚å¾ŒéæœŸ
                };
                
                // é€™æ˜¯ä¸€å€‹ç°¡åŒ–çš„tokenï¼Œå¯¦éš›ç’°å¢ƒä¸­æ‡‰è©²ç”±å¾Œç«¯ç”Ÿæˆ
                const token = btoa(JSON.stringify(payload));
                
                // è¨­ç½®åˆ°localStorage
                localStorage.setItem('token', 'Bearer ' + token);
                localStorage.setItem('user', JSON.stringify({
                    id: 1,
                    username: 'temp_user',
                    role: 'user'
                }));
                
                showStatus('âœ… ä¿®å¾©æˆåŠŸï¼Token å·²ç¶“è¨­ç½®å®Œæˆã€‚ç¾åœ¨æ‚¨å¯ä»¥å˜—è©¦æŸ¥çœ‹æª”æ¡ˆç€è¦½å™¨äº†ã€‚', 'success');
                
                // 3ç§’å¾Œè‡ªå‹•æ¸¬è©¦
                setTimeout(() => {
                    testFileViewer();
                }, 3000);
                
            } catch (error) {
                showStatus('âŒ ä¿®å¾©å¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        function testFileViewer() {
            showStatus('ğŸ”„ æ­£åœ¨æ¸¬è©¦æª”æ¡ˆç€è¦½å™¨...', 'info');
            
            // æ¸¬è©¦APIç«¯é»
            fetch('/api/file-viewer/list')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('APIå›æ‡‰ç‹€æ…‹ï¼š' + response.status);
                })
                .then(data => {
                    showStatus('âœ… æ¸¬è©¦æˆåŠŸï¼æª”æ¡ˆç€è¦½å™¨æ‡‰è©²å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚<br><a href="/file-viewer.html" target="_blank" style="color: #007bff; text-decoration: none;">é»æ“Šé€™è£¡æ‰“é–‹æª”æ¡ˆç€è¦½å™¨</a>', 'success');
                })
                .catch(error => {
                    showStatus('âš ï¸ æ¸¬è©¦çµæœï¼š' + error.message + '<br>è«‹å˜—è©¦é‡æ–°æ•´ç†é é¢æˆ–è¯ç¹«ç®¡ç†å“¡ã€‚', 'error');
                });
        }

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ç•¶å‰ç‹€æ…‹
        window.onload = function() {
            const token = localStorage.getItem('token');
            if (token) {
                showStatus('â„¹ï¸ æª¢æ¸¬åˆ°ç¾æœ‰ Tokenã€‚å¦‚æœæª”æ¡ˆç€è¦½å™¨ä»ç„¶ç„¡æ³•å·¥ä½œï¼Œè«‹é»æ“Šä¿®å¾©æŒ‰éˆ•ã€‚', 'info');
            } else {
                showStatus('âš ï¸ æœªæª¢æ¸¬åˆ° Tokenã€‚è«‹é»æ“Šä¿®å¾©æŒ‰éˆ•ä¾†è¨­ç½®å¿…è¦çš„èªè­‰ä¿¡æ¯ã€‚', 'error');
            }
        };
    </script>
</body>
</html>